<!DOCTYPE html><html lang="zh"><meta charset="UTF-8"><link rel="icon" type="image/x-icon" href="data:image/x-icon;,"><meta name="viewport" content="width=device-width,initial-scale=1"><title>配置管理</title><link rel="stylesheet" href="/static/shared-styles.css"><script src="/static/shared.js"></script><h1>配置管理</h1><div class="container"><div class="form-group"><label>路径:</label> <select id="path"><option value="/">根路径 (/)<option value="/logs">日志页面 (/logs)<option value="/config">配置页面 (/config)<option value="/tokeninfo">Token 信息页面 (/tokeninfo)<option value="/static/shared-styles.css">共享样式 (/static/shared-styles.css)<option value="/static/shared.js">共享脚本 (/static/shared.js)<option value="/about">关于页面 (/about)<option value="/readme">ReadMe文档 (/readme)<option value="/api">api调用 (/api)</select></div><div class="form-group"><label>内容类型:</label> <select id="content_type"><option value="default">默认<option value="text">纯文本<option value="html">HTML</select></div><div class="form-group"><label>内容:</label> <textarea id="content"></textarea></div><div class="form-group"><label>流第一个块检查:</label> <select id="enable_stream_check"><option value="">保持不变<option value="true">启用<option value="false">禁用</select></div><div class="form-group"><label>包含停止流:</label> <select id="include_stop_stream"><option value="">保持不变<option value="true">启用<option value="false">禁用</select></div><div class="form-group"><label>图片处理能力:</label> <select id="vision_ability"><option value="">保持不变<option value="disabled">禁用<option value="base64-only">仅 Base64<option value="base64-http">Base64 + HTTP</select></div><div class="form-group"><label>慢速池:</label> <select id="enable_slow_pool"><option value="">保持不变<option value="true">启用<option value="false">禁用</select></div><div class="form-group"><label>允许所有Claude模型:</label> <select id="enable_all_claude"><option value="">保持不变<option value="true">启用<option value="false">禁用</select></div><div class="form-group"><label>使用量检查模型规则:</label> <select id="check_usage_models_type"><option value="">保持不变<option value="none">禁用<option value="default">默认<option value="all">所有<option value="list">自定义列表</select> <input id="check_usage_models_list" placeholder="模型列表，以逗号分隔" style="display:none"></div><div class="form-group"><label>认证令牌:</label> <input type="password" id="authToken"></div><div class="button-group"><button onclick='updateConfig("get")'>获取配置</button> <button onclick='updateConfig("update")'>更新配置</button> <button onclick='updateConfig("reset")' class="secondary">重置配置</button></div></div><div id="result" class="message"></div><script>async function fetchConfig(){const e=document.getElementById("path").value,t=await makeAuthenticatedRequest("/config",{body:JSON.stringify({action:"get",path:e})});if(t){let n="";const a=t.data.page_content;if("default"===a?.type){const t=await fetch(e);n=await t.text()}else"text"!==a?.type&&"html"!==a?.type||(n=a.content);document.getElementById("content").value=n||"",document.getElementById("content_type").value=a?.type||"default";let l=t.data.vision_ability||"";switch(l){case"none":l="disabled";break;case"base64":l="base64-only";break;case"all":l="base64-http"}document.getElementById("enable_stream_check").value=parseStringFromBoolean(t.data.enable_stream_check,""),document.getElementById("include_stop_stream").value=parseStringFromBoolean(t.data.include_stop_stream,""),document.getElementById("vision_ability").value=l,document.getElementById("enable_slow_pool").value=parseStringFromBoolean(t.data.enable_slow_pool,""),document.getElementById("enable_all_claude").value=parseStringFromBoolean(t.data.enable_all_claude,""),document.getElementById("check_usage_models_type").value=t.data.check_usage_models?.type||"",document.getElementById("check_usage_models_list").value="list"===t.data.check_usage_models?.type?t.data.check_usage_models?.content||"":document.getElementById("check_usage_models_list").value}}async function updateConfig(e){if("get"===e)return void await fetchConfig();const t=document.getElementById("content_type").value,n=document.getElementById("content").value;let a={type:"default"};"update"===e&&"default"!==t&&(a={type:t,content:n});const l={action:e,path:document.getElementById("path").value,...a&&{content:a},...document.getElementById("enable_stream_check").value&&{enable_stream_check:parseBooleanFromString(document.getElementById("enable_stream_check").value)},...document.getElementById("include_stop_stream").value&&{include_stop_stream:parseBooleanFromString(document.getElementById("include_stop_stream").value)},...document.getElementById("vision_ability").value&&{vision_ability:document.getElementById("vision_ability").value},...document.getElementById("enable_slow_pool").value&&{enable_slow_pool:parseBooleanFromString(document.getElementById("enable_slow_pool").value)},...document.getElementById("enable_all_claude").value&&{enable_all_claude:parseBooleanFromString(document.getElementById("enable_all_claude").value)},...document.getElementById("check_usage_models_type").value&&{check_usage_models:{type:document.getElementById("check_usage_models_type").value,..."list"===document.getElementById("check_usage_models_type").value&&{content:document.getElementById("check_usage_models_list").value}}}},o=await makeAuthenticatedRequest("/config",{body:JSON.stringify(l)});o&&(showMessage("result",o.message,!1),"update"!==e&&"reset"!==e||await fetchConfig())}function showSuccess(e){showMessage("result",e,!1)}function showError(e){showMessage("result",e,!0)}document.getElementById("path").addEventListener("change",fetchConfig),document.getElementById("content_type").addEventListener("change",(function(){document.getElementById("content").disabled="default"===this.value})),initializeTokenHandling("authToken"),document.getElementById("check_usage_models_type").addEventListener("change",(function(){document.getElementById("check_usage_models_list").style.display="list"===this.value?"inline-block":"none"}))</script>